# UniHR SaaS â€” UX æµç¨‹å…¨è§’è‰²æª¢è¦–å ±å‘Š

> **å»ºç«‹æ—¥æœŸ**ï¼š2026-02-07  
> **æª¢è¦–è€…**ï¼šUX å·¥ç¨‹å¸«  
> **æ¶µè“‹ç¯„åœ**ï¼šç§Ÿæˆ¶å‰ç«¯ï¼ˆapp.unihr.comï¼‰ï¼‹ Admin å¾Œå°ï¼ˆadmin.unihr.comï¼‰  
> **ç³»çµ±ç‰ˆæœ¬**ï¼šPhase 1-4 å®Œæˆå¾Œ

---

## ç›®éŒ„

1. [è§’è‰²å®šç¾©](#ä¸€è§’è‰²å®šç¾©)
2. [ç³»çµ±æ¶æ§‹åœ–](#äºŒç³»çµ±æ¶æ§‹åœ–)
3. [ç§Ÿæˆ¶å‰ç«¯ç”¨æˆ¶æ—…ç¨‹åœ–](#ä¸‰ç§Ÿæˆ¶å‰ç«¯ç”¨æˆ¶æ—…ç¨‹åœ–)
4. [Admin å¾Œå°ç®¡ç†æµç¨‹åœ–](#å››admin-å¾Œå°ç®¡ç†æµç¨‹åœ–)
5. [å„è§’è‰² Page å¯è¦‹æ€§çŸ©é™£](#äº”å„è§’è‰²-page-å¯è¦‹æ€§çŸ©é™£)
6. [æµç¨‹å•é¡Œç›¤é»](#å…­æµç¨‹å•é¡Œç›¤é»)
7. [å„è§’è‰²å®Œæ•´æµç¨‹è©³å¯©](#ä¸ƒå„è§’è‰²å®Œæ•´æµç¨‹è©³å¯©)
8. [å¾Œç«¯æ¬Šé™å¼·åˆ¶çŸ©é™£](#å…«å¾Œç«¯æ¬Šé™å¼·åˆ¶çŸ©é™£)
9. [å»ºè­°ä¿®å¾©å„ªå…ˆé †åº](#ä¹å»ºè­°ä¿®å¾©å„ªå…ˆé †åº)

---

## ä¸€ã€è§’è‰²å®šç¾©

| è§’è‰² | ç³»çµ± | æ¬Šé™ç­‰ç´š | èªªæ˜ |
|------|------|---------|------|
| **Superuser** | Admin å¾Œå° | æœ€é«˜ | å¹³å°ç‡Ÿé‹è€…ï¼Œè·¨ç§Ÿæˆ¶ç®¡ç†æ‰€æœ‰ç§Ÿæˆ¶èˆ‡åŸºç¤è¨­æ–½ |
| **Owner** | ç§Ÿæˆ¶å‰å° | ç§Ÿæˆ¶æœ€é«˜ | å…¬å¸æ“æœ‰è€…ï¼Œå®Œæ•´ç®¡ç†æ¬Šï¼ˆå«è¨‚é–±å‡ç´šï¼‰ |
| **Admin** | ç§Ÿæˆ¶å‰å° | é«˜ | å…¬å¸ç®¡ç†å“¡ï¼Œç­‰åŒ Ownerï¼ˆé™¤è¨‚é–±å‡ç´šå¤–ï¼‰ |
| **HR** | ç§Ÿæˆ¶å‰å° | ä¸­ | äººè³‡äººå“¡ï¼Œå¯ç®¡ç†æ–‡ä»¶ä¸Šå‚³èˆ‡éƒ¨é–€ |
| **Employee** | ç§Ÿæˆ¶å‰å° | ä½ | ä¸€èˆ¬å“¡å·¥ï¼ŒAI å•ç­”èˆ‡æ–‡ä»¶ç€è¦½ |
| **Viewer** | ç§Ÿæˆ¶å‰å° | æœ€ä½ | ç€è¦½è€…ï¼Œå”¯è®€å­˜å– |

### è§’è‰²ç¹¼æ‰¿é—œä¿‚

```
å¹³å°å±¤ï¼ˆadmin.unihr.comï¼‰
  â””â”€â”€ Superuserï¼ˆå¹³å°è¶…ç´šç®¡ç†å“¡ï¼‰
        â†“ ç®¡ç†æ‰€æœ‰ç§Ÿæˆ¶

ç§Ÿæˆ¶å±¤ï¼ˆapp.unihr.comï¼‰
  â””â”€â”€ Ownerï¼ˆç§Ÿæˆ¶æ“æœ‰è€…ï¼‰
        â†“ å®Œæ•´ç®¡ç†æ¬Š
      â””â”€â”€ Adminï¼ˆç§Ÿæˆ¶ç®¡ç†å“¡ï¼‰
            â†“ æ¬¡ç´šç®¡ç†
          â””â”€â”€ HRï¼ˆäººè³‡ï¼‰
                â†“ æ–‡ä»¶/éƒ¨é–€ç®¡ç†
              â””â”€â”€ Employeeï¼ˆä¸€èˆ¬å“¡å·¥ï¼‰
                    â†“ åŸºç¤ä½¿ç”¨
                  â””â”€â”€ Viewerï¼ˆç€è¦½è€…ï¼‰
```

---

## äºŒã€ç³»çµ±æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph "å¹³å°å±¤ï¼ˆadmin.unihr.comï¼‰"
        SU["ğŸ”´ Superuser<br/>å¹³å°è¶…ç´šç®¡ç†å“¡"]
    end

    subgraph "ç§Ÿæˆ¶å±¤ï¼ˆapp.unihr.comï¼‰"
        OW["ğŸ‘‘ Owner<br/>ç§Ÿæˆ¶æ“æœ‰è€…"]
        AD["âš™ï¸ Admin<br/>ç§Ÿæˆ¶ç®¡ç†å“¡"]
        HR["ğŸ‘¤ HR<br/>äººè³‡"]
        EM["ğŸ’¼ Employee<br/>ä¸€èˆ¬å“¡å·¥"]
        VW["ğŸ‘ï¸ Viewer<br/>ç€è¦½è€…"]
    end

    SU -->|ç®¡ç†æ‰€æœ‰ç§Ÿæˆ¶| OW
    OW -->|å®Œæ•´ç®¡ç†æ¬Š| AD
    AD -->|æ¬¡ç´šç®¡ç†| HR
    HR -->|æ–‡ä»¶/éƒ¨é–€ç®¡ç†| EM
    EM -->|åŸºç¤ä½¿ç”¨| VW
```

---

## ä¸‰ã€ç§Ÿæˆ¶å‰ç«¯ç”¨æˆ¶æ—…ç¨‹åœ–

```mermaid
flowchart TD
    Start([è¨ªå• app.unihr.com]) --> Login[ç™»å…¥é é¢]
    Login -->|å¸³è™Ÿå¯†ç¢¼| Auth[JWT èªè­‰]
    Login -->|SSO| SSOFlow[SSO æµç¨‹]
    SSOFlow -->|è¼¸å…¥ Tenant ID| GetProviders[å–å¾— SSO Providers]
    GetProviders -->|Google| GoogleOAuth[Google OAuth]
    GetProviders -->|Microsoft| MicrosoftOAuth[Microsoft OAuth]
    GoogleOAuth -->|Callback| SSOCallback[/login/callback]
    MicrosoftOAuth -->|Callback| SSOCallback
    SSOCallback -->|æˆåŠŸ| Home[é¦–é  AI å•ç­”]
    Auth -->|æˆåŠŸ| Home
    Auth -->|å¤±æ•—| Login

    Home --> Chat[ğŸ’¬ AI å•ç­”<br/>æ‰€æœ‰è§’è‰²]
    Home --> Docs[ğŸ“„ æ–‡ä»¶ç®¡ç†<br/>æ‰€æœ‰è§’è‰²ï¼ˆä¸Šå‚³éœ€ HR+ï¼‰]

    Home -->|Owner/Admin| Usage[ğŸ“Š ç”¨é‡çµ±è¨ˆ]
    Home -->|Owner/Admin| Audit[ğŸ“‹ ç¨½æ ¸æ—¥èªŒ]
    Home -->|Owner/Admin/HR| Dept[ğŸ¢ éƒ¨é–€ç®¡ç†]
    Home -->|Owner/Admin| Company[ğŸ  å…¬å¸ç®¡ç†]
    Home -->|Owner/Admin| Brand[ğŸ¨ å“ç‰Œè¨­å®š]
    Home -->|Owner/Admin| Sub[ğŸ’³ è¨‚é–±æ–¹æ¡ˆ]
    Home -->|Owner/Admin| SSO[ğŸ”‘ SSO è¨­å®š]

    Company --> CompDash[å„€è¡¨æ¿]
    Company --> CompUsers[ä½¿ç”¨è€…ç®¡ç†]
    Company --> CompQuota[é…é¡æŸ¥çœ‹]
    Company --> CompUsage[ç”¨é‡åˆ†æ]
```

### é é¢èªªæ˜

| é é¢ | è·¯ç”± | å…ƒä»¶ | èªªæ˜ |
|------|------|------|------|
| ç™»å…¥ | `/login` | `LoginPage.tsx` | å¸³è™Ÿå¯†ç¢¼ + SSOï¼ˆGoogle/Microsoftï¼‰|
| SSO Callback | `/login/callback` | `SSOCallbackPage.tsx` | OAuth å›èª¿è™•ç† |
| AI å•ç­” | `/` (index) | `ChatPage.tsx` | å°è©±åˆ—è¡¨ + å³æ™‚å•ç­” + å¼•ç”¨ä¾†æº |
| æ–‡ä»¶ç®¡ç† | `/documents` | `DocumentsPage.tsx` | æ–‡ä»¶ CRUD + æ‹–æ‹‰ä¸Šå‚³ + ç‹€æ…‹ Polling |
| ç”¨é‡çµ±è¨ˆ | `/usage` | `UsagePage.tsx` | Token/è²»ç”¨/æŸ¥è©¢çµ±è¨ˆ + CSV/PDF åŒ¯å‡º |
| ç¨½æ ¸æ—¥èªŒ | `/audit` | `AuditLogsPage.tsx` | æ“ä½œæ—¥èªŒ + ç¯©é¸ + åŒ¯å‡º |
| éƒ¨é–€ç®¡ç† | `/departments` | `DepartmentsPage.tsx` | éƒ¨é–€ CRUD |
| å…¬å¸ç®¡ç† | `/company` | `CompanyPage.tsx` | 4 Tabï¼ˆå„€è¡¨æ¿/ä½¿ç”¨è€…/é…é¡/ç”¨é‡ï¼‰|
| å“ç‰Œè¨­å®š | `/branding` | `BrandingPage.tsx` | Logo/è‰²å½©/åç¨±/Favicon |
| è¨‚é–±æ–¹æ¡ˆ | `/subscription` | `SubscriptionPage.tsx` | æ–¹æ¡ˆå°æ¯” + å‡ç´š |
| SSO è¨­å®š | `/sso-settings` | `SSOSettingsPage.tsx` | SSO Provider CRUD + å•Ÿåœ |

---

## å››ã€Admin å¾Œå°ç®¡ç†æµç¨‹åœ–

```mermaid
flowchart TD
    Start([è¨ªå• admin.unihr.com]) --> Login[ç®¡ç†å“¡ç™»å…¥é é¢<br/>ç´…è‰²ä¸»é¡Œ + è­¦å‘Šæç¤º]
    Login -->|å¸³è™Ÿå¯†ç¢¼| Auth{is_superuser?}
    Auth -->|å¦| Reject[âŒ æ‹’çµ•ç™»å…¥]
    Auth -->|æ˜¯| Home[å¹³å°ç®¡ç†é¦–é ]

    Home --> Dashboard[ğŸ“Š å¹³å°ç¸½è¦½<br/>ç§Ÿæˆ¶æ•¸ / ç”¨æˆ¶æ•¸ / å¥åº·ç‹€æ…‹]
    Home --> Quotas[âš¡ é…é¡ç®¡ç†<br/>èª¿æ•´ç§Ÿæˆ¶é…é¡ / å¥—ç”¨æ–¹æ¡ˆ]
    Home --> Analytics[ğŸ“ˆ æˆæœ¬åˆ†æ<br/>æ¯æ—¥è¶¨å‹¢ / æœˆåº¦åˆ†æ / ç•°å¸¸åµæ¸¬]

    Dashboard --> TenantList[ç§Ÿæˆ¶åˆ—è¡¨]
    Dashboard --> TenantDetail[ç§Ÿæˆ¶è©³æƒ…<br/>çµ±è¨ˆ / å®‰å…¨è¨­å®š]
    Dashboard --> UserList[å…¨å¹³å°ä½¿ç”¨è€…]
    Dashboard --> Health[ç³»çµ±å¥åº·æª¢æŸ¥]

    Quotas --> QuotaView[æŸ¥çœ‹é…é¡]
    Quotas --> QuotaEdit[ä¿®æ”¹é…é¡]
    Quotas --> QuotaPlan[å¥—ç”¨æ–¹æ¡ˆæ¨¡æ¿]
    Quotas --> QuotaAlert[é…é¡è­¦å‘Š]

    Analytics --> DailyTrend[æ¯æ—¥æˆæœ¬è¶¨å‹¢åœ–]
    Analytics --> MonthlyTenant[æœˆåº¦ç§Ÿæˆ¶åˆ†æ]
    Analytics --> Anomaly[ç•°å¸¸åµæ¸¬]
    Analytics --> BudgetAlert[é ç®—è­¦å‘Š]
```

### Admin å¾Œå°é é¢

| é é¢ | è·¯ç”± | å…ƒä»¶ | èªªæ˜ |
|------|------|------|------|
| ç®¡ç†å“¡ç™»å…¥ | `/login` | `LoginPage.tsx` | Superuser å°ˆç”¨ï¼Œç´…è‰²ä¸»é¡Œ |
| å¹³å°ç®¡ç† | `/` (index) | `AdminPage.tsx` | 5 Tabï¼ˆç¸½è¦½/ç§Ÿæˆ¶/ä½¿ç”¨è€…/å®‰å…¨/å¥åº·ï¼‰|
| é…é¡ç®¡ç† | `/quotas` | `AdminQuotaPage.tsx` | ç§Ÿæˆ¶é…é¡èª¿æ•´ + æ–¹æ¡ˆå¥—ç”¨ |
| æˆæœ¬åˆ†æ | `/analytics` | `AnalyticsPage.tsx` | Recharts åœ–è¡¨ + ç•°å¸¸åµæ¸¬ |

---

## äº”ã€å„è§’è‰² Page å¯è¦‹æ€§çŸ©é™£

### ç§Ÿæˆ¶å‰ç«¯ï¼ˆapp.unihr.comï¼‰

| é é¢ | Owner | Admin | HR | Employee | Viewer |
|------|:-----:|:-----:|:--:|:--------:|:------:|
| AI å•ç­” | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ–‡ä»¶ç®¡ç†ï¼ˆç€è¦½ï¼‰ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ–‡ä»¶ç®¡ç†ï¼ˆä¸Šå‚³/åˆªé™¤ï¼‰ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç”¨é‡çµ±è¨ˆ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç¨½æ ¸æ—¥èªŒ | âœ… | âœ… | âŒ | âŒ | âŒ |
| éƒ¨é–€ç®¡ç† | âœ… | âœ… | âœ… | âŒ | âŒ |
| å…¬å¸ç®¡ç† | âœ… | âœ… | âŒ | âŒ | âŒ |
| å“ç‰Œè¨­å®š | âœ… | âœ… | âŒ | âŒ | âŒ |
| è¨‚é–±æ–¹æ¡ˆ | âœ… | âœ… | âŒ | âŒ | âŒ |
| SSO è¨­å®š | âœ… | âœ… | âŒ | âŒ | âŒ |
| è‡ªè¨‚åŸŸå | âœ… | âœ… | âŒ | âŒ | âŒ |
| å€åŸŸè¨­å®š | âœ… | âœ… | âŒ | âŒ | âŒ |

### Admin å¾Œå°ï¼ˆadmin.unihr.comï¼‰

| é é¢ | Superuser | å…¶ä»–è§’è‰² |
|------|:---------:|:--------:|
| å¹³å°ç®¡ç† | âœ… | âŒ |
| é…é¡ç®¡ç† | âœ… | âŒ |
| æˆæœ¬åˆ†æ | âœ… | âŒ |
| å€åŸŸç®¡ç† | âœ… | âŒ |

---

## å…­ã€æµç¨‹å•é¡Œç›¤é»

### ğŸ”´ åš´é‡å•é¡Œï¼ˆåŠŸèƒ½ç¼ºå¤±ï¼‰

| # | å•é¡Œ | å½±éŸ¿è§’è‰² | èªªæ˜ |
|---|------|---------|------|
| **F-1** | **ç„¡ CustomDomainsPage** | Owner/Admin | å¾Œç«¯æœ‰ 4 å€‹ CRUD ç«¯é»ï¼ˆT4-6ï¼‰ï¼Œä½†å‰ç«¯ç„¡é é¢ã€ç„¡è·¯ç”±ã€ç„¡å°èˆªå…¥å£ã€ç„¡ API å‡½å¼ |
| **F-2** | **ç„¡ RegionsPage** | Owner/Admin/Superuser | å¾Œç«¯æœ‰ 6 å€‹ç«¯é»ï¼ˆT4-19ï¼‰ï¼Œå‰ç«¯å®Œå…¨ç„¡å°æ‡‰ UIã€‚Admin å¾Œå°çš„ç§Ÿæˆ¶è©³æƒ…ä¹Ÿä¸é¡¯ç¤º region æ¬„ä½ |
| **F-3** | **Admin å¾Œå°ç„¡å€åŸŸç®¡ç†** | Superuser | ç„¡æ³•åœ¨å¾Œå°è¨­å®š/é·ç§»ç§Ÿæˆ¶å€åŸŸï¼Œä¹Ÿç„¡æ³•æŸ¥çœ‹è³‡æ–™é§ç•™åˆè¦æ‘˜è¦ |

### ğŸŸ¡ UX è¨­è¨ˆç¼ºé™·

| # | å•é¡Œ | å½±éŸ¿è§’è‰² | èªªæ˜ |
|---|------|---------|------|
| **U-1** | **Employee/Viewer å°èˆªéå°‘** | Employee, Viewer | åªçœ‹åˆ° 2 å€‹é é¢ï¼ˆAI å•ç­” + æ–‡ä»¶ç®¡ç†ï¼‰ï¼Œå´é‚Šæ¬„ç©ºæ› ï¼Œç¼ºä¹ã€Œæˆ‘çš„ã€é«”é©—æ„Ÿ |
| **U-2** | **Viewer å¯ä½¿ç”¨ AI å•ç­”** | Viewer | å¾Œç«¯ `chat.py` å’Œ `kb.py` ç„¡è§’è‰²é™åˆ¶ï¼ŒViewer å¯å®Œæ•´ä½¿ç”¨ AI å°è©±ã€‚è‹¥ Viewer è¨­è¨ˆç‚ºã€Œåªçœ‹ä¸åšã€ï¼Œé‚è¼¯çŸ›ç›¾ |
| **U-3** | **æ–‡ä»¶é é¢ç„¡éƒ¨é–€ç¯©é¸** | All | DocumentsPage åˆ—å‡ºå…¨éƒ¨æ–‡ä»¶ï¼Œç„¡æ³•æŒ‰éƒ¨é–€ç¯©é¸ã€‚ä½†å¾Œç«¯æœ‰éƒ¨é–€æ¨¡å‹ï¼Œæ–‡ä»¶ä¹Ÿæœ‰ `department_id` æ¬„ä½ |
| **U-4** | **è·¯ç”±ç„¡è§’è‰²å®ˆè¡›** | Employee, Viewer | `App.tsx` åªæª¢æŸ¥ tokenï¼Œä¸æª¢æŸ¥è§’è‰²ã€‚Employee å¯ç›´æ¥è¼¸å…¥ `/audit` URL å­˜å–â€”â€”é›–ç„¶å¾Œç«¯æœƒæ“‹ APIï¼Œä½†å‰ç«¯é¡¯ç¤ºç©ºé é¢æˆ–éŒ¯èª¤ |
| **U-5** | **SSO éœ€æ‰‹å‹•è¼¸å…¥ Tenant ID** | All | LoginPage SSO æµç¨‹è¦æ±‚æ‰‹å‹•å¡« Tenant IDï¼ˆUUIDï¼‰ï¼Œä¸€èˆ¬ä½¿ç”¨è€…ä¸çŸ¥é“ |
| **U-6** | **å“ç‰Œè¨­å®šç„¡å³æ™‚é è¦½** | Owner/Admin | å„²å­˜å¾Œæç¤ºã€Œé‡æ–°æ•´ç†é é¢å³å¯çœ‹åˆ°ã€ï¼Œæ‡‰å³æ™‚é è¦½ |
| **U-7** | **è¨‚é–±å‡ç´šç„¡ç¢ºèªæµç¨‹** | Owner | åªæœ‰åŸç”Ÿ `confirm()` å½ˆçª—ï¼Œç¼ºä¹è¨ˆè²»è©³æƒ…ã€ç”Ÿæ•ˆæ—¥æœŸç­‰ |

### ğŸŸ¢ å‰å¾Œç«¯æ¬Šé™ä¸€è‡´æ€§å•é¡Œ

| # | å•é¡Œ | èªªæ˜ |
|---|------|------|
| **P-1** | **å°èˆªéš±è— â‰  è·¯ç”±ä¿è­·** | Layout ç”¨ `roles` æ§åˆ¶å°èˆªé¡¯ç¤ºï¼Œä½† `App.tsx` è·¯ç”±ä¸åšè§’è‰²æª¢æŸ¥ã€‚ç›´æ¥è¼¸å…¥ URL å¯é€²å…¥é é¢ï¼ˆAPI æœƒ 403 ä½† UX å·®ï¼‰ |
| **P-2** | **å¾Œç«¯æ¬Šé™æª¢æŸ¥ä¸ä¸€è‡´** | `admin.py` ç”¨ `Depends(require_superuser)`ï¼Œ`tenant_admin.py` ç”¨ inline `_ensure_owner_admin()`ï¼Œ`tenants.py` ç”¨ `if not current_user.is_superuser`ã€‚ä¸‰ç¨®æ–¹å¼æ··ç”¨ |
| **P-3** | **tenant_admin.py import require_admin ä½†æœªä½¿ç”¨** | Import äº†å»æ”¹ç”¨æœ¬åœ°å‡½å¼ï¼Œæ­»ç¢¼ |
| **P-4** | **subscription.py plans ç«¯é»å®Œå…¨å…¬é–‹** | `GET /subscription/plans` ç„¡éœ€èªè­‰ï¼Œæ–¹æ¡ˆè³‡è¨Šæ˜¯å¦ç‚ºæ•æ„Ÿè³‡è¨Šéœ€è©•ä¼° |

---

## ä¸ƒã€å„è§’è‰²å®Œæ•´æµç¨‹è©³å¯©

### Role 1: Employeeï¼ˆä¸€èˆ¬å“¡å·¥ï¼‰

```
ç™»å…¥ â†’ AI å•ç­”ï¼ˆé è¨­é ï¼‰
       â”œâ”€â”€ æ–°å»ºå°è©± âœ…
       â”œâ”€â”€ æ­·å²å°è©±åˆ—è¡¨ âœ…
       â”œâ”€â”€ åˆªé™¤å°è©± âœ…
       â””â”€â”€ å¼•ç”¨ä¾†æºé¡¯ç¤ºï¼ˆå‹å‹•æ³• / å…¬å¸æ”¿ç­–ï¼‰âœ…
     â†’ æ–‡ä»¶ç®¡ç†
       â”œâ”€â”€ ç€è¦½æ–‡ä»¶åˆ—è¡¨ âœ…
       â”œâ”€â”€ ä¸Šå‚³æ–‡ä»¶ âŒï¼ˆcanManage = falseï¼‰
       â””â”€â”€ åˆªé™¤æ–‡ä»¶ âŒï¼ˆcanManage = falseï¼‰
     â†’ ç™»å‡º âœ…
```

**å•é¡Œ**ï¼š
- å´é‚Šæ¬„åªæœ‰ 2 å€‹é¸é …ï¼Œè¦–è¦ºç©ºæ´
- ç¼ºå°‘ã€Œå€‹äººè¨­å®šã€é é¢ï¼ˆä¿®æ”¹å¯†ç¢¼ã€åå¥½è¨­å®šï¼‰
- ç„¡æ³•æŸ¥çœ‹è‡ªå·±çš„ä½¿ç”¨é‡
- æ–‡ä»¶åªèƒ½çœ‹ä¸èƒ½æœå°‹ï¼ˆä½†å¯é€é AI å•ç­”é–“æ¥æœå°‹ï¼‰

---

### Role 2: HRï¼ˆäººè³‡ï¼‰

```
ç™»å…¥ â†’ AI å•ç­” âœ…
     â†’ æ–‡ä»¶ç®¡ç†
       â”œâ”€â”€ ç€è¦½ âœ…
       â”œâ”€â”€ ä¸Šå‚³ âœ…ï¼ˆcanManage = trueï¼‰
       â”œâ”€â”€ æ‹–æ‹‰ä¸Šå‚³ âœ…
       â”œâ”€â”€ åˆªé™¤ âœ…
       â””â”€â”€ è™•ç†ç‹€æ…‹å³æ™‚æ›´æ–°ï¼ˆpollingï¼‰âœ…
     â†’ éƒ¨é–€ç®¡ç†
       â”œâ”€â”€ éƒ¨é–€åˆ—è¡¨ âœ…
       â”œâ”€â”€ å»ºç«‹éƒ¨é–€ âœ…
       â””â”€â”€ åœç”¨éƒ¨é–€ âœ…
     â†’ ç™»å‡º âœ…
```

**å•é¡Œ**ï¼š
- éƒ¨é–€ç®¡ç†ç„¡æ¨¹ç‹€çµæ§‹é¡¯ç¤ºï¼ˆæ¨¡å‹æ”¯æ´ `parent_id` ä½† UI åªæ˜¯å¹³é¢åˆ—è¡¨ï¼‰
- ç„¡æ³•æŒ‡æ´¾ä½¿ç”¨è€…åˆ°éƒ¨é–€ï¼ˆéœ€å¾å…¬å¸ç®¡ç†é é¢æ“ä½œï¼Œä½† HR çœ‹ä¸åˆ°ï¼‰
- æ–‡ä»¶ç„¡æ³•æŒ‡æ´¾åˆ°éƒ¨é–€

---

### Role 3: Owner / Adminï¼ˆç§Ÿæˆ¶ç®¡ç†è€…ï¼‰

```
ç™»å…¥ â†’ AI å•ç­” âœ…
     â†’ æ–‡ä»¶ç®¡ç† âœ…ï¼ˆå®Œæ•´ CRUDï¼‰
     â†’ ç”¨é‡çµ±è¨ˆ
       â”œâ”€â”€ ç¸½è¦½å¡ç‰‡ï¼ˆToken / è²»ç”¨ / æŸ¥è©¢æ•¸ï¼‰âœ…
       â”œâ”€â”€ æŒ‰å‹•ä½œé¡å‹åˆ†æè¡¨ âœ…
       â””â”€â”€ åŒ¯å‡º CSV / PDF âœ…
     â†’ ç¨½æ ¸æ—¥èªŒ
       â”œâ”€â”€ æ—¥èªŒåˆ—è¡¨ï¼ˆå«ç¯©é¸ï¼‰âœ…
       â””â”€â”€ åŒ¯å‡º CSV / PDF âœ…
     â†’ éƒ¨é–€ç®¡ç† âœ…
     â†’ å…¬å¸ç®¡ç†
       â”œâ”€â”€ å„€è¡¨æ¿ï¼ˆKPI å¡ç‰‡ï¼‰âœ…
       â”œâ”€â”€ ä½¿ç”¨è€…ç®¡ç†ï¼ˆé‚€è«‹ / ç·¨è¼¯ / åœç”¨ï¼‰âœ…
       â”œâ”€â”€ é…é¡æŸ¥çœ‹ âœ…
       â””â”€â”€ ç”¨é‡åˆ†æï¼ˆæŒ‰ä½¿ç”¨è€…ï¼‰âœ…
     â†’ å“ç‰Œè¨­å®š
       â”œâ”€â”€ Logo URL âœ…
       â”œâ”€â”€ ä¸»è‰²/å‰¯è‰² âœ…
       â”œâ”€â”€ å“ç‰Œåç¨± âœ…
       â””â”€â”€ Favicon âœ…
     â†’ è¨‚é–±æ–¹æ¡ˆ
       â”œâ”€â”€ æ–¹æ¡ˆåˆ—è¡¨ï¼ˆFree / Pro / Enterpriseï¼‰âœ…
       â”œâ”€â”€ ç•¶å‰æ–¹æ¡ˆ âœ…
       â”œâ”€â”€ åŠŸèƒ½å°æ¯” âœ…
       â””â”€â”€ å‡ç´š âœ…ï¼ˆOwner é™å®šï¼‰
     â†’ SSO è¨­å®š
       â”œâ”€â”€ æŸ¥çœ‹å·²é…ç½® Provider âœ…
       â”œâ”€â”€ æ–°å¢ Google / Microsoft âœ…
       â”œâ”€â”€ å•Ÿç”¨/åœç”¨ âœ…
       â””â”€â”€ åˆªé™¤ âœ…
     â†’ è‡ªè¨‚åŸŸå âŒ **ç¼ºå¤±**
     â†’ å€åŸŸè¨­å®š âŒ **ç¼ºå¤±**
     â†’ ç™»å‡º âœ…
```

---

### Role 4: Superuserï¼ˆAdmin å¾Œå°ï¼‰

```
ç™»å…¥ï¼ˆadmin.unihr.comï¼‰â†’ å¹³å°ç®¡ç†
     â”œâ”€â”€ å¹³å°ç¸½è¦½
     â”‚   â”œâ”€â”€ ç§Ÿæˆ¶åˆ—è¡¨ï¼ˆæœå°‹ / ç‹€æ…‹ç¯©é¸ï¼‰âœ…
     â”‚   â”œâ”€â”€ ç§Ÿæˆ¶è©³æƒ…ï¼ˆçµ±è¨ˆ / å®‰å…¨è¨­å®šï¼‰âœ…
     â”‚   â”œâ”€â”€ å…¨å¹³å°ä½¿ç”¨è€…åˆ—è¡¨ âœ…
     â”‚   â””â”€â”€ ç³»çµ±å¥åº·æª¢æŸ¥ âœ…
     â”œâ”€â”€ é…é¡ç®¡ç†
     â”‚   â”œâ”€â”€ é¸æ“‡ç§Ÿæˆ¶ âœ…
     â”‚   â”œâ”€â”€ æŸ¥çœ‹/ä¿®æ”¹é…é¡ âœ…
     â”‚   â”œâ”€â”€ å¥—ç”¨æ–¹æ¡ˆæ¨¡æ¿ âœ…
     â”‚   â””â”€â”€ é…é¡è­¦å‘ŠæŸ¥çœ‹ âœ…
     â””â”€â”€ æˆæœ¬åˆ†æ
         â”œâ”€â”€ æ¯æ—¥è¶¨å‹¢åœ–ï¼ˆRechartsï¼‰âœ…
         â”œâ”€â”€ æœˆåº¦ç§Ÿæˆ¶åˆ†æ âœ…
         â”œâ”€â”€ ç•°å¸¸åµæ¸¬ âœ…
         â””â”€â”€ é ç®—è­¦å‘Š âœ…
     â†’ å€åŸŸç®¡ç† âŒ **ç¼ºå¤±**
     â†’ è‡ªè¨‚åŸŸåç®¡ç† âŒ **ç¼ºå¤±**
     â†’ Celery Worker ç›£æ§ âŒ **ç¼ºå¤±**
     â†’ ç™»å‡º âœ…
```

---

## å…«ã€å¾Œç«¯æ¬Šé™å¼·åˆ¶çŸ©é™£

### èªè­‰ä¾è³´å‡½å¼

| ä¾è³´å‡½å¼ | èªªæ˜ |
|----------|------|
| `get_current_user` | è§£ç¢¼ JWTï¼Œå›å‚³ `User` ç‰©ä»¶ï¼ˆåƒ…é©—è­‰ token æœ‰æ•ˆæ€§ï¼‰ |
| `get_current_active_user` | åœ¨ `get_current_user` ä¹‹ä¸Šæª¢æŸ¥ `is_active` |
| `require_superuser` | è¦æ±‚ `is_superuser == True` |
| `require_admin` | `PermissionChecker(["owner", "admin"])` â€” å…è¨± owner/adminï¼ˆsuperuser bypassï¼‰ |
| `require_hr` | `PermissionChecker(["owner", "admin", "hr"])` |
| `check_document_permission` | ä¾ actionï¼ˆcreate/update/delete éœ€ owner/admin/hrï¼›read å…¨é–‹ï¼‰ |
| `check_audit_permission` | é™ superuser/owner/admin |
| `check_user_management_permission` | é™ superuser/owner/admin |
| `check_department_permission` | é™ superuser/owner/admin/hr |
| `check_feature_enabled` | æª¢æŸ¥åŠŸèƒ½æ¨¡çµ„æ˜¯å¦å°è§’è‰²å•Ÿç”¨ |

### ç«¯é»æ¬Šé™çŸ©é™£

| ç«¯é»æª”æ¡ˆ | Auth Dependency | è§’è‰²é™åˆ¶ | å‚™è¨» |
|----------|-----------------|---------|------|
| `auth.py` | **ç„¡** | ç„¡ | ç™»å…¥ç«¯é»ï¼Œè¨­è¨ˆç„¡éœ€èªè­‰ âœ… |
| `chat.py` | `get_current_active_user` | ç„¡é¡å¤–è§’è‰²é™åˆ¶ | æ‰€æœ‰ 5 å€‹ç«¯é»éœ€ç™»å…¥ï¼›`enforce_query_quota` é…é¡é™åˆ¶ |
| `documents.py` | `get_current_active_user` | `check_document_permission` | è®€å–å…¨é–‹ï¼›å¯«å…¥/åˆªé™¤éœ€ owner/admin/hr |
| `users.py` | `get_current_active_user` | `check_user_management_permission` | `GET /me` å…¨é–‹ï¼›`POST /` éœ€ owner/admin |
| `tenants.py` | `get_current_active_user` | inline `is_superuser` âš ï¸ | æ‡‰æ”¹ç”¨ `require_superuser` dependency |
| `admin.py` | `require_superuser` | Superuser only âœ… | ç´„ 10 å€‹ç«¯é»çµ±ä¸€ä½¿ç”¨ |
| `analytics.py` | `require_superuser` | Superuser only âœ… | 4 å€‹ç«¯é»çµ±ä¸€ä½¿ç”¨ |
| `audit.py` | `get_current_active_user` | `check_audit_permission` | superuser/owner/admin |
| `departments.py` | `get_current_active_user` | `check_department_permission` + feature check | owner/admin/hr |
| `sso.py` | **æ··åˆ** | owner/admin ç®¡ç†è¨­å®š | 3 å€‹å…¬é–‹ç«¯é» + 4 å€‹ç®¡ç†ç«¯é» inline check âš ï¸ |
| `feature_flags.py` | `require_superuser` | Superuser only | `/{key}/evaluate` å…è¨±æ‰€æœ‰ç™»å…¥ç”¨æˆ¶ |
| `tenant_admin.py` | `get_current_active_user` | `_ensure_owner_admin()` âš ï¸ | import äº† `require_admin` ä½†æœªä½¿ç”¨ |
| `subscription.py` | **æ··åˆ** | owner(å‡ç´š), owner/admin(åŒ¯å‡º) | `GET /plans` å®Œå…¨å…¬é–‹ |
| `custom_domains.py` | `get_current_active_user` | `_ensure_owner_admin()` âš ï¸ | æ‰€æœ‰ç«¯é»éœ€ owner/admin |
| `regions.py` | **æ··åˆ** | Superuserï¼ˆé·ç§»/åˆè¦ï¼‰ | `GET /` å’Œ `GET /current` å…¬é–‹ |
| `public.py` | **ç„¡** | ç„¡ | `GET /branding` è¨­è¨ˆç‚ºå…¬é–‹ âœ… |
| `kb.py` | `get_current_active_user` | ç„¡è§’è‰²é™åˆ¶ | æ‰€æœ‰è§’è‰²å¯æœå°‹ |

### è¨­è¨ˆæ­£ç¢ºçš„å…¬é–‹ç«¯é»

| ç«¯é» | èªªæ˜ |
|------|------|
| `POST /auth/login/access-token` | ç™»å…¥ âœ… |
| `GET /public/branding` | å“ç‰Œè¼‰å…¥ âœ… |
| `GET /subscription/plans` | æ–¹æ¡ˆåˆ—è¡¨ âœ… |
| `GET /auth/sso/providers/{tenant_id}` | SSO Provider åˆ—è¡¨ âœ… |
| `POST /auth/sso/state` | SSO ç‹€æ…‹å»ºç«‹ âœ… |
| `POST /auth/sso/callback` | SSO å›èª¿ âœ… |
| `GET /regions` | å€åŸŸåˆ—è¡¨ âœ… |
| `GET /regions/current` | ç•¶å‰å€åŸŸ âœ… |

---

## ä¹ã€å»ºè­°ä¿®å¾©å„ªå…ˆé †åº

| å„ªå…ˆç´š | # | é …ç›® | å°æ‡‰å•é¡Œ | å½±éŸ¿è§’è‰² | å·¥ä½œé‡ |
|--------|---|------|---------|---------|--------|
| **P0** | 1 | å»ºç«‹ `CustomDomainsPage`ï¼ˆç§Ÿæˆ¶å‰ç«¯ï¼‰ | F-1 | Owner/Admin | ä¸­ |
| **P0** | 2 | å»ºç«‹ `RegionsPage`ï¼ˆç§Ÿæˆ¶ + Admin å‰ç«¯ï¼‰ | F-2, F-3 | Owner/Admin/Superuser | ä¸­ |
| **P1** | 3 | å‰ç«¯è·¯ç”±è§’è‰²å®ˆè¡› `RoleGuard` | U-4, P-1 | Employee/Viewer | å° |
| **P2** | 4 | Employeeã€Œæˆ‘çš„ç”¨é‡ã€é é¢ | U-1 | Employee | å° |
| **P2** | 5 | SSO Tenant ID æ”¹ email domain è‡ªå‹•è­˜åˆ¥ | U-5 | All | ä¸­ |
| **P2** | 6 | æ–‡ä»¶é é¢éƒ¨é–€ç¯©é¸ | U-3 | All | å° |
| **P3** | 7 | å“ç‰Œè¨­å®šå³æ™‚é è¦½ | U-6 | Owner/Admin | å° |
| **P3** | 8 | è¨‚é–±å‡ç´šç¢ºèªæµç¨‹ Modal | U-7 | Owner | å° |
| **P3** | 9 | å¾Œç«¯æ¬Šé™çµ±ä¸€ç‚º Dependency Injection | P-2, P-3 | â€” | å° |
| **P3** | 10 | éƒ¨é–€ç®¡ç†æ¨¹ç‹€çµæ§‹ | Role 2 å•é¡Œ | HR | ä¸­ |

### ä¿®å¾©å¾Œé æœŸæ•ˆæœ

```
ä¿®å¾©å‰                              ä¿®å¾©å¾Œ
â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€
Employee å´é‚Šæ¬„ï¼š2 é …    â†’    Employee å´é‚Šæ¬„ï¼š3 é …ï¼ˆ+ æˆ‘çš„ç”¨é‡ï¼‰
ç›´æ¥è¼¸å…¥ URL å¯é€²å…¥     â†’    RoleGuard é‡å°è‡³é¦–é  + toast æç¤º
SSO éœ€è¼¸å…¥ UUID         â†’    è¼¸å…¥ email è‡ªå‹•å¸¶å‡º Tenant
è‡ªè¨‚åŸŸåç„¡ UI           â†’    å®Œæ•´ CRUD + DNS é©—è­‰å¼•å°
å¤šå€åŸŸç„¡ UI             â†’    å€åŸŸæŸ¥çœ‹ + åˆè¦å ±å‘Š
å“ç‰Œå„²å­˜éœ€é‡æ•´          â†’    å³æ™‚é è¦½è‰²å½©/Logo è®Šæ›´
è¨‚é–±å‡ç´šåªæœ‰ confirm()  â†’    è©³ç´° Modalï¼ˆåƒ¹æ ¼/åŠŸèƒ½å°æ¯”/ç”Ÿæ•ˆæ—¥ï¼‰
```

---

## é™„éŒ„ï¼šæŠ€è¡“é—œéµæª”æ¡ˆåƒç…§

### å‰ç«¯ï¼ˆç§Ÿæˆ¶ï¼‰

| æª”æ¡ˆ | ç”¨é€” |
|------|------|
| `frontend/src/App.tsx` | è·¯ç”±å®šç¾© |
| `frontend/src/components/Layout.tsx` | å´é‚Šæ¬„å°èˆª + è§’è‰²ç¯©é¸ |
| `frontend/src/auth.tsx` | èªè­‰ Context (JWT) |
| `frontend/src/api.ts` | API å®¢æˆ¶ç«¯ï¼ˆaxiosï¼‰ |
| `frontend/src/types.ts` | TypeScript å‹åˆ¥ |
| `frontend/src/contexts/BrandingContext.tsx` | ç™½æ¨™å“ç‰Œ Context |

### å‰ç«¯ï¼ˆAdminï¼‰

| æª”æ¡ˆ | ç”¨é€” |
|------|------|
| `admin-frontend/src/App.tsx` | è·¯ç”± + Superuser å®ˆè¡› |
| `admin-frontend/src/components/Layout.tsx` | ç´…è‰²ä¸»é¡Œå´é‚Šæ¬„ |
| `admin-frontend/src/api.ts` | Admin API å®¢æˆ¶ç«¯ |

### å¾Œç«¯

| æª”æ¡ˆ | ç”¨é€” |
|------|------|
| `app/api/deps.py` | èªè­‰ä¾è³´å‡½å¼ |
| `app/api/deps_permissions.py` | è§’è‰²æ¬Šé™ä¾è³´å‡½å¼ |
| `app/models/user.py` | UserRole å®šç¾©ï¼ˆ5 è§’è‰² enumï¼‰ |
| `app/models/permission.py` | FeaturePermission æ¨¡å‹ |
| `admin_service/__init__.py` | Admin å¾®æœå‹™ + Service Token ä¸­é–“ä»¶ |
